require('polyfills')();
var debugging = require('debugging');
var canvas = require('canvas');
var world = require('world');
var view = require('view');
var input = require('input');
var gestures = require('gestures');
var physics = require('physics');
var gameObjects = require('game-objects');
var game = require('game');
var scenery = require('scenery');
// var sound = require('sound');
var textures = require('textures');
var tweener = require('tweener');

function main() {
	textures.init(startGame);
	// gestures.shoot.setCallback(gameObjects.elephant.fireArrow);
}
function startGame() {
	canvas.init();
	view.init();
	world.init();
	view.addRenderPass(world.getRenderPass());
	view.addResizeHandler(world.onResize);
	input.init();
	gestures.init();
	physics.init(world);
	gameObjects.init();
	game.init();
	scenery.init(world);
	physics.setScenery(scenery);
	// sound.init();
	view.setPreRender(preRender);
	view.setOnEnterFrame(onEnterFrame);
	// startLoop();
}
function preRender() {
	physics.update();
	world.setCameraBounds(gameObjects.hero.getSightBounds());
	scenery.preRender();
}

function onEnterFrame() {
	gestures.onEnterFrame();
}

function startLoop() { 
	sound.play('bg', 'Heartbeat');
}

function stopLoop() { 
	sound.stop('bg', 'Heartbeat');
}

module.exports = main;