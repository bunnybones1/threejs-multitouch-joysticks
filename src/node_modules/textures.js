var assetsPath = 'assets/images/';
var three = require('three');

var texturesData = [
	'icon_boy.png',
	'icon_cat.png',
	'icon_dog.png',
	'icon_girl.png',
	'icon_wife.png'
];

var textures = {};

var ready;


var texturesToLoad = texturesData.length;
function onSuccess() {
	texturesToLoad--;
	if(texturesToLoad === 0) {
		ready();
	}
}

function onError() {
	throw new Error('Nope!');
}

var geometry;
function getGeometry(){
	if(!geometry) {
		geometry = new three.PlaneGeometry(1, 1);
	}
	return geometry;
}

var materials = {};
function getMaterial(fileName) {
	if(!materials[fileName]) {
		var texture = textures[fileName];
		materials[fileName] = new three.MeshBasicMaterial({
			map: texture,
			transparent: true,
			depthTest: false
		});
	}
	return materials[fileName];
}

function getSprite(fileName) {
	var geometry = getGeometry();
	var material = getMaterial(fileName);
	var mesh = new three.Mesh(geometry, material);
	mesh.scale.set(material.map.image.width, material.map.image.height, 1);
	return mesh;
}

function init(callback) {
	ready = callback;
	texturesData.forEach(function(fileName) {
		var texture = three.ImageUtils.loadTexture(
			assetsPath + fileName,
			undefined,
			onSuccess,
			onError
		);
		textures[fileName] = texture;
	});
}

module.exports = {
	getSprite:getSprite,
	init: init
};
