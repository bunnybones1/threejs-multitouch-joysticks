var Checkerboard = require('threejs-texture-checkerboard');
var three = require('three');
var world = require('world');

var initd = false;

function init() {
	if(initd) return;
	initd = true;

	var scene = world.scene;

	testPlane = new three.Mesh(
		new three.PlaneGeometry(10000, 10000, 1, 1),
		new three.MeshBasicMaterial({
			map: new Checkerboard(undefined, undefined, 100, 100),
		})
	);
	testPlane.position.set(5000, 5000, -10);
	scene.add(testPlane);

	registerTeleportee(testPlane);

	module.exports.teleport = teleport;
	delete module.exports.init;
}

var teleportees = [];
function teleport(distance) {
	teleportees.forEach(function(teleportee) {
		teleportee.position.x += distance;
	});
}

function registerTeleportee(object) {
	teleportees.push(object);
}

function deregisterTeleportee(object) {
	var index = teleportees.indexOf(object);
	if(index !== -1) {
		teleportees.splice(index, 1);
	}
}

module.exports = {
	init: init
};